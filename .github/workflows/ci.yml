name: CI

# Controls when the action will run.
on:
  # Triggers the workflow on push or pull request events but only for main branch
  push:
    branches: [main]
  pull_request:
    branches: [main]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  # Build workflow
  build:
    # self hosted runner to build on a RPI
    runs-on: self-hosted

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Stop currently running server
        run: |
          sudo systemctl stop plunge-server.service
        if: success()

      - name: Build the server
        run: |
          go build -o ~/plunger/plunger-server

      - name: Start the server
        run: |
          sudo systemctl start plunge-server.service
        if: success()
